decluttering_templates:
  battery_status_template:
    card:
      type: custom:mushroom-template-badge
      content: |
        [[text]]: {{ states('[[entity]]') }}
      icon: mdi:battery-sync
      color: |
        {% if states('[[entity]]') in ['Discharge'] %}
          green
        {% elif states('[[entity]]') in ['Charge'] %}
          purple
        {% elif states('[[entity]]') in ['Standby'] %}
          yellow
        {% else %}
          red
        {% endif %}
views:
  - type: sections
    path: overzicht
    title: Overzicht
    icon: mdi:battery
    cards: []
    sections:
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 🔋 Batterij 1
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.lilygo_rs485_1_marstek_battery_state_of_charge
                name: Laadniveau
                icon: mdi:battery-charging
                features_position: bottom
                vertical: false
                show_entity_picture: false
                hide_state: false
                features:
                  - type: bar-gauge
              - type: tile
                entity: sensor.lilygo_rs485_1_marstek_battery_remaining_capacity
                name: Resterende capaciteit
                icon: mdi:battery
                features_position: bottom
                vertical: false
                features:
                  - type: trend-graph
          - type: custom:mushroom-entity-card
            entity: sensor.batterij_resttijd
            name: Rest tijd
            icon: mdi:battery-high
            icon_color: blue
            tap_action:
              action: more-info
            hold_action:
              action: none
            double_tap_action:
              action: none
            grid_options:
              columns: full
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 🔋 Batterij 2
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.lilygo_rs485_2_marstek_battery_state_of_charge
                name: Laadniveau
                icon: mdi:battery-charging
                features_position: bottom
                vertical: false
                show_entity_picture: false
                hide_state: false
                features:
                  - type: bar-gauge
              - type: tile
                entity: sensor.lilygo_rs485_2_marstek_battery_remaining_capacity
                name: Resterende capaciteit
                icon: mdi:battery
                features_position: bottom
                vertical: false
                features:
                  - type: trend-graph
          - type: custom:mushroom-entity-card
            entity: sensor.batterij_resttijd_batt_2
            name: Rest tijd
            icon: mdi:battery-high
            icon_color: blue
            tap_action:
              action: more-info
            hold_action:
              action: none
            double_tap_action:
              action: none
            grid_options:
              columns: full
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 🔋 Batterij 3
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.lilygo_rs485_3_marstek_battery_state_of_charge
                name: Laadniveau
                icon: mdi:battery-charging
                features_position: bottom
                vertical: false
                show_entity_picture: false
                hide_state: false
                features:
                  - type: bar-gauge
              - type: tile
                entity: sensor.lilygo_rs485_3_marstek_battery_remaining_capacity
                name: Resterende capaciteit
                icon: mdi:battery
                features_position: bottom
                vertical: false
                features:
                  - type: trend-graph
          - type: custom:mushroom-entity-card
            entity: sensor.batterij_resttijd_batt_3
            name: Rest tijd
            icon: mdi:battery-high
            icon_color: blue
            tap_action:
              action: more-info
            hold_action:
              action: none
            double_tap_action:
              action: none
            grid_options:
              columns: full
    header:
      card:
        type: markdown
        text_only: true
        content: '# Batterijen Overzicht'
    badges:
      - type: custom:decluttering-card
        template: battery_status_template
        variables:
          - entity: sensor.lilygo_rs485_1_marstek_inverter_state
          - text: Batterij 1
      - type: custom:decluttering-card
        template: battery_status_template
        variables:
          - entity: sensor.lilygo_rs485_2_marstek_inverter_state
          - text: Batterij 2
      - type: custom:decluttering-card
        template: battery_status_template
        variables:
          - entity: sensor.lilygo_rs485_3_marstek_inverter_state
          - text: Batterij 3
  - type: sections
    max_columns: 3
    dense_section_placement: true
    header:
      card:
        type: markdown
        content: '# 🔋 Batterij 1'
      layout: center
      badges_position: bottom
      badges_wrap: wrap
    badges:
      - type: custom:decluttering-card
        template: battery_status_template
        variables:
          - entity: sensor.lilygo_rs485_1_marstek_inverter_state
          - text: Batterij 1
      - type: custom:mushroom-template-badge
        content: >
          WiFi-signaal: {{ states('sensor.lilygo_rs485_1_wifi_signal_strength')
          }} dBm
        icon: mdi:wifi
        color: >
          {% set rssi = states('sensor.lilygo_rs485_1_wifi_signal_strength') |
          int %} {% if rssi < -80 %} red {% elif rssi < -65 %} orange {% else %}
          green {% endif %}
      - type: custom:mushroom-template-badge
        content: >
          Interne temp: {{
          states('sensor.lilygo_rs485_1_marstek_internal_temperature') | float |
          round(1) }}°C
        icon: mdi:thermometer
        color: >
          {% set t =
          states('sensor.lilygo_rs485_1_marstek_internal_temperature') | float
          %} {% if t < 30 %} green {% elif t < 45 %} orange {% else %} red {%
          endif %}
        tap_action:
          action: more-info
        entity: sensor.lilygo_rs485_1_marstek_internal_temperature
    sections:
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 🧰 Celinformatie
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.lilygo_rs485_1_marstek_battery_state_of_charge
                name: Laadniveau
                icon: mdi:battery-charging
                features_position: bottom
                vertical: false
                show_entity_picture: false
                hide_state: false
                features:
                  - type: bar-gauge
              - type: tile
                entity: sensor.lilygo_rs485_1_marstek_battery_remaining_capacity
                name: Resterende capaciteit
                icon: mdi:battery
                features_position: bottom
                vertical: false
                features:
                  - type: trend-graph
          - type: vertical-stack
            cards:
              - type: custom:mushroom-template-badge
                entity: sensor.lilygo_rs485_1_marstek_ac_voltage
                content: >
                  {% set val =
                  states('sensor.lilygo_rs485_1_marstek_ac_voltage') %} {% if
                  val not in ['unknown', 'unavailable', None, ''] %}
                    Gem. batterijspanning: {{ '{0:.1f}'.format(val | float) }} V
                  {% else %}
                    Gem. batterijspanning: --
                  {% endif %}
                icon: mdi:car-battery
                color: >
                  {% set v = states('sensor.lilygo_rs485_1_marstek_ac_voltage')
                  | float(0) %} {% if v < 50 %} red {% else %} green {% endif %}
                tap_action:
                  action: more-info
              - type: custom:mushroom-template-badge
                content: >
                  {% set val =
                  states('sensor.lilygo_rs485_1_marstek_battery_cell_voltage_delta')
                  %} {% if val not in ['unknown', 'unavailable', None] %}
                    Celspanningsverschil: {{ '{0:.0f}'.format(val | float * 1000) }} mV
                  {% else %} Celspanningsverschil: -- {% endif %}
                icon: mdi:flash-alert
                color: >
                  {% set v =
                  states('sensor.lilygo_rs485_1_marstek_battery_cell_voltage_delta')
                  | float %} {% if v > 0.010 %} red {% elif v >= 0.008 %} orange
                  {% else %} green {% endif %}
                tap_action:
                  action: more-info
                entity: sensor.lilygo_rs485_1_marstek_battery_cell_voltage_delta
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_1_marstek_battery_maximum_cell_voltage
                    name: Max. celspanning
                    icon: mdi:flash-outline
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_1_marstek_battery_minimum_cell_voltage
                    name: Min. celspanning
                    icon: mdi:flash-outline
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_1_marstek_internal_mos1_temperature
                    name: MOS1 temp.
                    icon: mdi:thermometer-lines
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_1_marstek_internal_mos2_temperature
                    name: MOS2 temp.
                    icon: mdi:thermometer-lines
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_1_marstek_max_cell_temperature
                    name: Max. celtemp.
                    icon: mdi:thermometer-high
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_1_marstek_min_cell_temperature
                    name: Min. celtemp.
                    icon: mdi:thermometer-low
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: ⚡ AC & DC Waarden
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_ac_power
                name: AC vermogen
                icon: mdi:flash
                icon_color: yellow
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_ac_voltage
                name: AC spanning
                icon: mdi:power-plug
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_ac_current
                name: AC stroom
                icon: mdi:current-ac
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_battery_voltage_average
                name: DC spanning
                icon: mdi:power-socket
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_battery_current_average
                name: DC stroom
                icon: mdi:current-dc
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_battery_power
                name: DC vermogen
                icon: mdi:flash-outline
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 🌐 Netwerk & verbinding
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_esp_ip
                name: IP-adres
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_esp_ssid
                name: WiFi SSID
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_battery_wifi_signal
                name: WiFi-status
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_bt_status
                name: Bluetooth-status
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_cloud_status
                name: Cloud-verbinding
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_network_abnormal
                name: Netwerkprobleem
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_wifi_abnormal
                name: WiFi-probleem
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 📊 Energieopbrengst
          - type: vertical-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.maandelijkse_efficiency
                name: Maandelijkse efficiëntie
                icon: mdi:calendar-month
                icon_color: purple
                hold_action:
                  action: none
                double_tap_action:
                  action: none
                tap_action:
                  action: more-info
              - type: custom:mushroom-entity-card
                entity: sensor.totaal_efficiency
                name: Totale efficiëntie
                icon: mdi:battery-high
                icon_color: blue
                tap_action:
                  action: more-info
                hold_action:
                  action: none
                double_tap_action:
                  action: none
              - type: custom:mushroom-entity-card
                entity: sensor.batterij_resttijd
                name: Rest tijd
                icon: mdi:battery-high
                icon_color: blue
                tap_action:
                  action: more-info
                hold_action:
                  action: none
                double_tap_action:
                  action: none
          - type: vertical-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_daily_charging_energy
                name: Dagelijkse lading
                icon: mdi:calendar-today
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_daily_discharging_energy
                name: Dagelijkse ontlading
                icon: mdi:calendar-today-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_monthly_charging_energy
                name: Maandelijkse lading
                icon: mdi:calendar-month
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_monthly_discharging_energy
                name: Maandelijkse ontlading
                icon: mdi:calendar-month-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_total_charging_energy
                name: Totale lading
                icon: mdi:calendar-month-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_marstek_total_discharging_energy
                name: Totale ontlading
                icon: mdi:calendar-month-outline
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 📦 Systeeminformatie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_software_version
                name: Softwareversie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_firmware_version
                name: Firmwareversie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_bms_version
                name: BMS-versie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_esp_version
                name: ESPHome-versie
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: ⚙️ Besturing & instellingen
              - type: custom:mushroom-entity-card
                entity: select.lilygo_rs485_1_marstek_rs485_control_mode
                name: Control mode
                icon: mdi:cog-outline
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_1_marstek_forcible_charge_power
                name: Geforceerd laden
                icon: mdi:battery-plus
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_1_marstek_forcible_discharge_power
                name: Geforceerd ontladen
                icon: mdi:battery-minus
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_1_marstek_max_charge_power
                name: Max. laadvermogen
                icon: mdi:transmission-tower-export
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_1_marstek_max_discharge_power
                name: Max. ontlaadvermogen
                icon: mdi:transmission-tower-import
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_1_marstek_charge_to_soc
                name: Laaddoel (SOC)
                icon: mdi:battery-charging-100
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_1_marstek_charging_cutoff_capacity
                name: Laadstop bij
                icon: mdi:battery-off
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_1_marstek_discharging_cutoff_capacity
                name: Ontlaadstop bij
                icon: mdi:battery-arrow-down
              - type: custom:mushroom-entity-card
                entity: select.lilygo_rs485_1_marstek_user_work_mode
                name: Werkmodus
                icon: mdi:cog-outline
              - type: custom:mushroom-entity-card
                entity: button.stick_restart
                name: Stick herstarten
                icon: mdi:restart
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 🚨 Fouten & waarschuwingen
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_fan_abnormal_warning
                name: Ventilatorfout
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_low_battery_soc_warning
                name: Laadniveau laag
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_overtemperature_limit
                name: Overtemperatuur
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_grid_overvoltage
                name: Netspanning te hoog
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_bat_communication_failure
                name: Batterijcommunicatie
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_1_marstek_bms_protect
                name: BMS-beveiliging actief
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_1_power_restriction
                name: Vermogensbeperking
                icon: mdi:alert
    cards: []
    title: Batterij 1
  - type: sections
    path: batterij-2
    title: Batterij 2
    max_columns: 3
    header:
      card:
        type: markdown
        content: '# 🔋 Batterij 2'
      layout: center
      badges_position: bottom
      badges_wrap: wrap
    cards: []
    badges:
      - type: custom:decluttering-card
        template: battery_status_template
        variables:
          - entity: sensor.lilygo_rs485_2_marstek_inverter_state
          - text: Status
      - type: custom:mushroom-template-badge
        content: >
          WiFi-signaal: {{ states('sensor.lilygo_rs485_2_wifi_signal_strength')
          }} dBm
        icon: mdi:wifi
        color: >
          {% set rssi = states('sensor.lilygo_rs485_2_wifi_signal_strength') |
          int %} {% if rssi < -80 %} red {% elif rssi < -65 %} orange {% else %}
          green {% endif %}
      - type: custom:mushroom-template-badge
        content: >
          Interne temp: {{
          states('sensor.lilygo_rs485_2_marstek_internal_temperature') | float |
          round(1) }}°C
        icon: mdi:thermometer
        color: >
          {% set t =
          states('sensor.lilygo_rs485_2_marstek_internal_temperature') | float
          %} {% if t < 30 %} green {% elif t < 45 %} orange {% else %} red {%
          endif %}
        tap_action:
          action: more-info
        entity: sensor.lilygo_rs485_2_marstek_internal_temperature
    sections:
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 🧰 Celinformatie
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.lilygo_rs485_2_marstek_battery_state_of_charge
                name: Laadniveau
                icon: mdi:battery-charging
                features_position: bottom
                vertical: false
                show_entity_picture: false
                hide_state: false
                features:
                  - type: bar-gauge
              - type: tile
                entity: sensor.lilygo_rs485_2_marstek_battery_remaining_capacity
                name: Resterende capaciteit
                icon: mdi:battery
                features_position: bottom
                vertical: false
                features:
                  - type: trend-graph
          - type: vertical-stack
            cards:
              - type: custom:mushroom-template-badge
                entity: sensor.lilygo_rs485_2_marstek_ac_voltage
                content: >
                  {% set val =
                  states('sensor.lilygo_rs485_2_marstek_ac_voltage') %} {% if
                  val not in ['unknown', 'unavailable', None, ''] %}
                    Gem. batterijspanning: {{ '{0:.1f}'.format(val | float) }} V
                  {% else %}
                    Gem. batterijspanning: --
                  {% endif %}
                icon: mdi:car-battery
                color: >
                  {% set v = states('sensor.lilygo_rs485_2_marstek_ac_voltage')
                  | float(0) %} {% if v < 50 %} red {% else %} green {% endif %}
                tap_action:
                  action: more-info
              - type: custom:mushroom-template-badge
                content: >
                  {% set val =
                  states('sensor.lilygo_rs485_2_marstek_battery_cell_voltage_delta')
                  %} {% if val not in ['unknown', 'unavailable', None] %}
                    Celspanningsverschil: {{ '{0:.0f}'.format(val | float * 1000) }} mV
                  {% else %} Celspanningsverschil: -- {% endif %}
                icon: mdi:flash-alert
                color: >
                  {% set v =
                  states('sensor.lilygo_rs485_2_marstek_battery_cell_voltage_delta')
                  | float %} {% if v > 0.010 %} red {% elif v >= 0.008 %} orange
                  {% else %} green {% endif %}
                tap_action:
                  action: more-info
                entity: sensor.lilygo_rs485_2_marstek_battery_cell_voltage_delta
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_2_marstek_battery_maximum_cell_voltage
                    name: Max. celspanning
                    icon: mdi:flash-outline
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_2_marstek_battery_minimum_cell_voltage
                    name: Min. celspanning
                    icon: mdi:flash-outline
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_2_marstek_internal_mos1_temperature
                    name: MOS1 temp.
                    icon: mdi:thermometer-lines
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_2_marstek_internal_mos2_temperature
                    name: MOS2 temp.
                    icon: mdi:thermometer-lines
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_2_marstek_max_cell_temperature
                    name: Max. celtemp.
                    icon: mdi:thermometer-high
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_2_marstek_min_cell_temperature
                    name: Min. celtemp.
                    icon: mdi:thermometer-low
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: ⚡ AC & DC Waarden
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_ac_power
                name: AC vermogen
                icon: mdi:flash
                icon_color: yellow
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_ac_voltage
                name: AC spanning
                icon: mdi:power-plug
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_ac_current
                name: AC stroom
                icon: mdi:current-ac
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_battery_voltage_average
                name: DC spanning
                icon: mdi:power-socket
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_battery_current_average
                name: DC stroom
                icon: mdi:current-dc
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_battery_power
                name: DC vermogen
                icon: mdi:flash-outline
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 🌐 Netwerk & verbinding
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_esp_ip
                name: IP-adres
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_esp_ssid
                name: WiFi SSID
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_battery_wifi_signal
                name: WiFi-status
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_bt_status
                name: Bluetooth-status
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_cloud_status
                name: Cloud-verbinding
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_network_abnormal
                name: Netwerkprobleem
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_wifi_abnormal
                name: WiFi-probleem
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 📊 Energieopbrengst
          - type: vertical-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.maandelijkse_efficiency_batt_2
                name: Maandelijkse efficiëntie
                icon: mdi:calendar-month
                icon_color: purple
                hold_action:
                  action: none
                double_tap_action:
                  action: none
                tap_action:
                  action: more-info
              - type: custom:mushroom-entity-card
                entity: sensor.totaal_efficiency_batt_2
                name: Totale efficiëntie
                icon: mdi:battery-high
                icon_color: blue
                tap_action:
                  action: more-info
                hold_action:
                  action: none
                double_tap_action:
                  action: none
              - type: custom:mushroom-entity-card
                entity: sensor.batterij_resttijd_batt_2
                name: Rest tijd
                icon: mdi:battery-high
                icon_color: blue
                tap_action:
                  action: more-info
                hold_action:
                  action: none
                double_tap_action:
                  action: none
          - type: vertical-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_daily_charging_energy
                name: Dagelijkse lading
                icon: mdi:calendar-today
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_daily_discharging_energy
                name: Dagelijkse ontlading
                icon: mdi:calendar-today-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_monthly_charging_energy
                name: Maandelijkse lading
                icon: mdi:calendar-month
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_monthly_discharging_energy
                name: Maandelijkse ontlading
                icon: mdi:calendar-month-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_total_charging_energy
                name: Totale lading
                icon: mdi:calendar-month-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_marstek_total_discharging_energy
                name: Totale ontlading
                icon: mdi:calendar-month-outline
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 📦 Systeeminformatie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_software_version
                name: Softwareversie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_firmware_version
                name: Firmwareversie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_bms_version
                name: BMS-versie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_esp_version
                name: ESPHome-versie
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: ⚙️ Besturing & instellingen
              - type: custom:mushroom-entity-card
                entity: select.lilygo_rs485_2_marstek_rs485_control_mode
                name: Control mode
                icon: mdi:cog-outline
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_2_marstek_forcible_charge_power
                name: Geforceerd laden
                icon: mdi:battery-plus
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_2_marstek_forcible_discharge_power
                name: Geforceerd ontladen
                icon: mdi:battery-minus
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_2_marstek_max_charge_power
                name: Max. laadvermogen
                icon: mdi:transmission-tower-export
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_2_marstek_max_discharge_power
                name: Max. ontlaadvermogen
                icon: mdi:transmission-tower-import
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_2_marstek_charge_to_soc
                name: Laaddoel (SOC)
                icon: mdi:battery-charging-100
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_2_marstek_charging_cutoff_capacity
                name: Laadstop bij
                icon: mdi:battery-off
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_2_marstek_discharging_cutoff_capacity
                name: Ontlaadstop bij
                icon: mdi:battery-arrow-down
              - type: custom:mushroom-entity-card
                entity: select.lilygo_rs485_2_marstek_user_work_mode
                name: Werkmodus
                icon: mdi:cog-outline
              - type: custom:mushroom-entity-card
                entity: button.stick_restart
                name: Stick herstarten
                icon: mdi:restart
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 🚨 Fouten & waarschuwingen
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_fan_abnormal_warning
                name: Ventilatorfout
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_low_battery_soc_warning
                name: Laadniveau laag
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_overtemperature_limit
                name: Overtemperatuur
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_grid_overvoltage
                name: Netspanning te hoog
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_bat_communication_failure
                name: Batterijcommunicatie
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_2_marstek_bms_protect
                name: BMS-beveiliging actief
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_2_power_restriction
                name: Vermogensbeperking
                icon: mdi:alert
  - type: sections
    path: batterij-3
    title: Batterij 3
    cards: []
    max_columns: 3
    header:
      card:
        type: markdown
        content: '# 🔋 Batterij 3'
      layout: center
      badges_position: bottom
      badges_wrap: wrap
    badges:
      - type: custom:decluttering-card
        template: battery_status_template
        variables:
          - entity: sensor.lilygo_rs485_3_marstek_inverter_state
          - text: Status
      - type: custom:mushroom-template-badge
        content: >
          WiFi-signaal: {{ states('sensor.lilygo_rs485_3_wifi_signal_strength')
          }} dBm
        icon: mdi:wifi
        color: >
          {% set rssi = states('sensor.lilygo_rs485_3_wifi_signal_strength') |
          int %} {% if rssi < -80 %} red {% elif rssi < -65 %} orange {% else %}
          green {% endif %}
      - type: custom:mushroom-template-badge
        content: >
          Interne temp: {{
          states('sensor.lilygo_rs485_3_marstek_internal_temperature') | float |
          round(1) }}°C
        icon: mdi:thermometer
        color: >
          {% set t =
          states('sensor.lilygo_rs485_3_marstek_internal_temperature') | float
          %} {% if t < 30 %} green {% elif t < 45 %} orange {% else %} red {%
          endif %}
        tap_action:
          action: more-info
        entity: sensor.lilygo_rs485_3_marstek_internal_temperature
    sections:
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 🧰 Celinformatie
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.lilygo_rs485_3_marstek_battery_state_of_charge
                name: Laadniveau
                icon: mdi:battery-charging
                features_position: bottom
                vertical: false
                show_entity_picture: false
                hide_state: false
                features:
                  - type: bar-gauge
              - type: tile
                entity: sensor.lilygo_rs485_3_marstek_battery_remaining_capacity
                name: Resterende capaciteit
                icon: mdi:battery
                features_position: bottom
                vertical: false
                features:
                  - type: trend-graph
          - type: vertical-stack
            cards:
              - type: custom:mushroom-template-badge
                entity: sensor.lilygo_rs485_3_marstek_ac_voltage
                content: >
                  {% set val =
                  states('sensor.lilygo_rs485_3_marstek_ac_voltage') %} {% if
                  val not in ['unknown', 'unavailable', None, ''] %}
                    Gem. batterijspanning: {{ '{0:.1f}'.format(val | float) }} V
                  {% else %}
                    Gem. batterijspanning: --
                  {% endif %}
                icon: mdi:car-battery
                color: >
                  {% set v = states('sensor.lilygo_rs485_3_marstek_ac_voltage')
                  | float(0) %} {% if v < 50 %} red {% else %} green {% endif %}
                tap_action:
                  action: more-info
              - type: custom:mushroom-template-badge
                content: >
                  {% set val =
                  states('sensor.lilygo_rs485_3_marstek_battery_cell_voltage_delta')
                  %} {% if val not in ['unknown', 'unavailable', None] %}
                    Celspanningsverschil: {{ '{0:.0f}'.format(val | float * 1000) }} mV
                  {% else %} Celspanningsverschil: -- {% endif %}
                icon: mdi:flash-alert
                color: >
                  {% set v =
                  states('sensor.lilygo_rs485_3_marstek_battery_cell_voltage_delta')
                  | float %} {% if v > 0.010 %} red {% elif v >= 0.008 %} orange
                  {% else %} green {% endif %}
                tap_action:
                  action: more-info
                entity: sensor.lilygo_rs485_3_marstek_battery_cell_voltage_delta
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_3_marstek_battery_maximum_cell_voltage
                    name: Max. celspanning
                    icon: mdi:flash-outline
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_3_marstek_battery_minimum_cell_voltage
                    name: Min. celspanning
                    icon: mdi:flash-outline
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_3_marstek_internal_mos1_temperature
                    name: MOS1 temp.
                    icon: mdi:thermometer-lines
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_3_marstek_internal_mos2_temperature
                    name: MOS2 temp.
                    icon: mdi:thermometer-lines
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_3_marstek_max_cell_temperature
                    name: Max. celtemp.
                    icon: mdi:thermometer-high
                  - type: custom:mushroom-entity-card
                    entity: sensor.lilygo_rs485_3_marstek_min_cell_temperature
                    name: Min. celtemp.
                    icon: mdi:thermometer-low
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: ⚡ AC & DC Waarden
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_ac_power
                name: AC vermogen
                icon: mdi:flash
                icon_color: yellow
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_ac_voltage
                name: AC spanning
                icon: mdi:power-plug
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_ac_current
                name: AC stroom
                icon: mdi:current-ac
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_battery_voltage_average
                name: DC spanning
                icon: mdi:power-socket
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_battery_current_average
                name: DC stroom
                icon: mdi:current-dc
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_battery_power
                name: DC vermogen
                icon: mdi:flash-outline
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 🌐 Netwerk & verbinding
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_esp_ip
                name: IP-adres
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_esp_ssid
                name: WiFi SSID
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_battery_wifi_signal
                name: WiFi-status
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_bt_status
                name: Bluetooth-status
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_cloud_status
                name: Cloud-verbinding
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_network_abnormal
                name: Netwerkprobleem
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_wifi_abnormal
                name: WiFi-probleem
      - type: grid
        cards:
          - type: custom:mushroom-title-card
            title: 📊 Energieopbrengst
          - type: vertical-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.maandelijkse_efficiency_batt_3
                name: Maandelijkse efficiëntie
                icon: mdi:calendar-month
                icon_color: purple
                hold_action:
                  action: none
                double_tap_action:
                  action: none
                tap_action:
                  action: more-info
              - type: custom:mushroom-entity-card
                entity: sensor.totaal_efficiency_batt_3
                name: Totale efficiëntie
                icon: mdi:battery-high
                icon_color: blue
                tap_action:
                  action: more-info
                hold_action:
                  action: none
                double_tap_action:
                  action: none
              - type: custom:mushroom-entity-card
                entity: sensor.batterij_resttijd_batt_3
                name: Rest tijd
                icon: mdi:battery-high
                icon_color: blue
                tap_action:
                  action: more-info
                hold_action:
                  action: none
                double_tap_action:
                  action: none
          - type: vertical-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_daily_charging_energy
                name: Dagelijkse lading
                icon: mdi:calendar-today
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_daily_discharging_energy
                name: Dagelijkse ontlading
                icon: mdi:calendar-today-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_monthly_charging_energy
                name: Maandelijkse lading
                icon: mdi:calendar-month
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_monthly_discharging_energy
                name: Maandelijkse ontlading
                icon: mdi:calendar-month-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_total_charging_energy
                name: Totale lading
                icon: mdi:calendar-month-outline
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_marstek_total_discharging_energy
                name: Totale ontlading
                icon: mdi:calendar-month-outline
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 📦 Systeeminformatie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_software_version
                name: Softwareversie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_firmware_version
                name: Firmwareversie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_bms_version
                name: BMS-versie
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_esp_version
                name: ESPHome-versie
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: ⚙️ Besturing & instellingen
              - type: custom:mushroom-entity-card
                entity: select.lilygo_rs485_3_marstek_rs485_control_mode
                name: Control mode
                icon: mdi:cog-outline
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_3_marstek_forcible_charge_power
                name: Geforceerd laden
                icon: mdi:battery-plus
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_3_marstek_forcible_discharge_power
                name: Geforceerd ontladen
                icon: mdi:battery-minus
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_3_marstek_max_charge_power
                name: Max. laadvermogen
                icon: mdi:transmission-tower-export
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_3_marstek_max_discharge_power
                name: Max. ontlaadvermogen
                icon: mdi:transmission-tower-import
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_3_marstek_charge_to_soc
                name: Laaddoel (SOC)
                icon: mdi:battery-charging-100
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_3_marstek_charging_cutoff_capacity
                name: Laadstop bij
                icon: mdi:battery-off
              - type: custom:mushroom-entity-card
                entity: number.lilygo_rs485_3_marstek_discharging_cutoff_capacity
                name: Ontlaadstop bij
                icon: mdi:battery-arrow-down
              - type: custom:mushroom-entity-card
                entity: select.lilygo_rs485_3_marstek_user_work_mode
                name: Werkmodus
                icon: mdi:cog-outline
              - type: custom:mushroom-entity-card
                entity: button.stick_restart
                name: Stick herstarten
                icon: mdi:restart
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 🚨 Fouten & waarschuwingen
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_fan_abnormal_warning
                name: Ventilatorfout
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_low_battery_soc_warning
                name: Laadniveau laag
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_overtemperature_limit
                name: Overtemperatuur
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_grid_overvoltage
                name: Netspanning te hoog
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_bat_communication_failure
                name: Batterijcommunicatie
              - type: custom:mushroom-entity-card
                entity: binary_sensor.lilygo_rs485_3_marstek_bms_protect
                name: BMS-beveiliging actief
              - type: custom:mushroom-entity-card
                entity: sensor.lilygo_rs485_3_power_restriction
                name: Vermogensbeperking
                icon: mdi:alert
